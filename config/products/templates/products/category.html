{% extends 'base.html' %}
{% load static %}

{% block title %}منتجات - {{ category.name }}{% endblock %}

{% block content %}
<section class="products-section">
    <div class="products-container">
        <h1 class="section-title">منتجات تصنيف: {{ category.name }}</h1>

        <form method="GET" action="{% url 'products:home' %}" class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input 
                type="search" 
                name="search" 
                id="searchInput" 
                placeholder="ابحث عن المنتجات..." 
                value="{{ search_query }}"
                autocomplete="off"
                enterkeyhint="search"
            >
            <button type="submit" class="search-btn">
                <i class="fas fa-search"></i>
                بحث
            </button>
        </form>

        {% if search_query %}
        <div style="text-align: center; margin-bottom: 2rem; padding: 1rem; background: rgba(27, 155, 216, 0.1); border-radius: 15px;">
            <p style="color: var(--secondary-color); font-size: 1.2rem; font-weight: 600; margin: 0;">
                نتائج البحث عن: "{{ search_query }}"
                <a href="{% url 'products:home' %}" style="color: #dc3545; text-decoration: none; margin-right: 1rem;">
                    <i class="fas fa-times-circle"></i> إلغاء البحث
                </a>
            </p>
        </div>
        {% endif %}

        {% if products %}
        <div class="offers-grid">
            {% for product in products %}
            <div class="offer-card">
                {% if product.discount_percentage > 0 %}
                <div class="offer-badge">خصم {{ product.discount_percentage }}%</div>
                {% endif %}
                
                <div class="offer-image">
                    {% with primary_img=product.images.all|first %}
                        {% if primary_img %}
                            <img src="{{ primary_img.image.url }}" alt="{{ product.name }}">
                        {% elif product.brand.logo %}
                            <img src="{{ product.brand.logo.url }}" alt="{{ product.brand.name }}">
                        {% else %}
                            <i class="{{ product.icon }}"></i>
                        {% endif %}
                    {% endwith %}
                </div>

                <div class="offer-content">
                    <h3>{{ product.name }}</h3>
                    <p>{{ product.description|truncatewords:20 }}</p>

                    <div class="offer-features">
                        <span><i class="fas fa-tag"></i> {{ product.category.name }}</span>
                        {% if product.brand %}
                            <span><i class="fas fa-building"></i> {{ product.brand.name }}</span>
                        {% endif %}
                        {% if product.stock > 0 %}
                            <span><i class="fas fa-check-circle"></i> متوفر</span>
                        {% else %}
                            <span style="background: rgba(255,0,0,0.1); color: #dc3545;"><i class="fas fa-times-circle"></i> غير متوفر</span>
                        {% endif %}
                    </div>

                    {% if product.discount_percentage > 0 %}
                        <div style="margin:15px 0;">
                            <span style="text-decoration:line-through; color:#999; font-size:1rem;">{{ product.price|floatformat:0 }} جنيه</span>
                            <span style="color:#28a745; font-weight:800; font-size:1.4rem; display:block; margin-top:5px;">{{ product.final_price|floatformat:0 }} جنيه</span>
                        </div>
                    {% else %}
                        <div class="product-price">{{ product.price|floatformat:0 }} جنيه</div>
                    {% endif %}

                    <button class="offer-btn" onclick="window.location.href='{% url 'products:detail' slug=product.slug %}'">
                        <i class="fas fa-arrow-left"></i>
                        عرض التفاصيل
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 4rem 0;">
            <i class="fas fa-box-open" style="font-size: 5rem; color: var(--secondary-color); opacity: 0.3; margin-bottom: 1rem;"></i>
            <p style="font-size: 1.5rem; color: var(--text-color);">
                لا توجد منتجات في هذا القسم حالياً
            </p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}